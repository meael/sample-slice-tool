# Ralph Progress Log
Started: Sun Feb  1 17:55:14 EET 2026

## Codebase Patterns
- Markers are managed via `useMarkers` hook in `src/hooks/useMarkers.ts`
- Visual marker rendering happens in `WaveformCanvas.tsx` via canvas drawing in `drawWaveform`
- Marker state includes `draggingMarkerIdRef` (ref for interaction) and `draggingMarkerId` (state for re-renders)
- Use state for visual updates that need re-renders, refs for values that change during mouse events

---

## 2026-02-01 - US-001
- Removed persistent marker selection state - markers now only show active styling during drag
- Changed `handleMouseDown` to allow dragging any marker (not just selected ones)
- Added `draggingMarkerId` state for visual feedback during drag only
- Removed keyboard Delete/Backspace deletion (users use context menu or × button instead)
- Updated `handleMouseUp` to not select markers on click
- Files changed:
  - `src/components/WaveformCanvas.tsx`
- **Learnings for future iterations:**
  - The `selectedMarkerId` prop and `onSelectMarker` callback still exist in props interface but are no longer used - left for backwards compatibility
  - Visual active state uses `draggingMarkerId` state variable (triggers re-render) while drag detection uses `draggingMarkerIdRef` (no re-render needed during mouse events)
  - Markers can be deleted via: context menu (right-click) or × button in MarkerControlStrip
---

## 2026-02-01 - US-003
- Expanded marker hover and drag hit area from 10px to 16px threshold
- The `MARKER_HIT_THRESHOLD` constant controls the invisible hit area for marker interaction
- Files changed:
  - `src/components/WaveformCanvas.tsx`
- **Learnings for future iterations:**
  - `MARKER_HIT_THRESHOLD` (line ~10 in WaveformCanvas.tsx) controls how far from a marker line users can click to grab it
  - The `findMarkerAtPixel` function finds the nearest marker within the threshold, so close markers are handled correctly (nearest wins)
  - Hit area is invisible - purely for hit-testing, no visual changes
---

## 2026-02-01 - US-004
- Fixed keyboard badge and close icon alignment above markers
- Close (×) icon is now centered directly above the marker line
- Keyboard badge is positioned to the left of the close icon using absolute positioning
- Files changed:
  - `src/components/MarkerControlStrip.tsx`
- **Learnings for future iterations:**
  - Marker control elements (keyboard badge, close icon, drag arrows) are rendered in `MarkerControlStrip.tsx`
  - Use `position: absolute` with `right: 100%` to position elements to the left of a centered element
  - The keyboard badge only appears for markers that start an enabled section (determined by `markerKeyboardIndexMap`)
---
